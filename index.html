<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fourier Series Foundations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="flex flex-col md:flex-row min-h-screen">
    <!-- Top Navigation Bar for page switching -->
    <div class="w-full bg-[#F0EBE3] border-b border-gray-300 flex items-center justify-center py-2 px-4">
        <nav class="flex space-x-6">
            <a href="index.html" class="text-spectral-purple font-semibold hover:underline">Fourier Foundations</a>
            <a href="bio.html" class="text-spectral-purple font-semibold hover:underline">BioXen Fourier Explorer</a>
            <a href="fdab.html" class="text-spectral-purple font-semibold hover:underline">FDA Biology Explorer</a>
        </nav>
    </div>
    <nav class="w-full md:w-64 bg-[#F0EBE3] p-4 md:p-6 flex-shrink-0">
        <h2 class="text-2xl font-bold mb-6 text-center md:text-left">Fourier Theory</h2>
        <ul id="navigation" class="space-y-2">
            <li><a href="#" data-target="historical" class="nav-link block p-3 rounded-lg font-medium">Historical Foundations</a></li>
            <li><a href="#" data-target="foundations" class="nav-link block p-3 rounded-lg font-medium active">Foundational Theory</a></li>
            <li><a href="#" data-target="convergence" class="nav-link block p-3 rounded-lg font-medium">Convergence & Gibbs</a></li>
            <li><a href="#" data-target="coefficients" class="nav-link block p-3 rounded-lg font-medium">Coefficient Properties</a></li>
            <li><a href="#" data-target="complex_coeffs" class="nav-link block p-3 rounded-lg font-medium">Complex Spectral Geometry</a></li>
            <li><a href="#" data-target="thd" class="nav-link block p-3 rounded-lg font-medium">Signal Quality (THD)</a></li>
            <li><a href="#" data-target="examples" class="nav-link block p-3 rounded-lg font-medium">Classic Waveforms</a></li>
            <li><a href="#" data-target="connections" class="nav-link block p-3 rounded-lg font-medium">Broader Connections</a></li>
        </ul>
    </nav>

    <main class="flex-1 p-6 md:p-10 overflow-y-auto">
        <header class="mb-8">
            <h1 class="text-4xl md:text-5xl font-bold">Interactive Exploration of Fourier Series</h1>
            <p class="text-lg mt-2 text-gray-600">A visual guide to the pure mathematical foundations of signal decomposition.</p>
            <p class="text-sm mt-2 text-blue-600 flex flex-col md:flex-row md:space-x-4">
                <span>
                    <a href="bio.html" class="hover:underline">ðŸ”¬ Explore BioXen Fourier Explorer</a> - Biological applications of frequency domain analysis
                </span>
                <span>
                    <a href="fdab.html" class="hover:underline">ðŸ§ª FDA Biology Explorer</a> - Advanced frequency domain demos
                </span>
            </p>
        </header>

        <div id="content-container">
            <section id="historical" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Historical Foundations: The Crisis of Rigor</h3>
                <div class="space-y-6 text-gray-700 leading-relaxed">
                    <p>Fourier's original assertion that a trigonometric series could represent any arbitrary functionâ€”including piecewise or discontinuous onesâ€”sparked a foundational crisis in 19th-century mathematics. Mathematicians like Euler and Lagrange held a restricted view of a "function" as a single analytical expression.[2]</p>
                    <p>The attempt to rigorously prove the convergence of Fourier series forced the development of modern mathematical analysis.[2] Bernhard Riemann's 1854 work, driven by this problem, led to the rigorous **Riemann integral**. However, full mathematical rigor, particularly guaranteeing the convergence properties in the mean-square sense, required the introduction of **Measure Theory** and the **Lebesgue integral** in the early 20th century, which established the function space $\mathcal{L}^2$ as a complete structure.[3, 4]</p>
                </div>
            </section>
            
            <section id="foundations" class="content-section">
                <h3 class="text-3xl font-semibold mb-4">Foundational Theory and $\mathcal{L}^2$ Hilbert Space</h3>
                <div class="space-y-6 text-gray-700 leading-relaxed">
                    <p>The rigorous basis for Fourier analysis is the **Hilbert space** $\mathcal{L}^2(\mathbb{T})$, the space of square-integrable periodic functions. This space is equipped with the inner product $\langle f, g \rangle = \frac{1}{2\pi} \int f(x) \overline{g(x)} dx$.</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li>**Orthogonality:** The set of exponential functions $\{e^{inx}\}_{n \in \mathbb{Z}}$ forms an **orthonormal basis** for $\mathcal{L}^2(\mathbb{T})$ because $\langle e^{in x}, e^{im x} \rangle = \delta_{n,m}$ (the Kronecker delta).</li>
                        <li>**Coefficients as Projections:** The Fourier coefficient $c_n(f) = \langle f, e_{n} \rangle$ is the orthogonal projection of the function $f$ onto the basis function $e_{n}$.[5]</li>
                        <li>**Completeness and Energy Conservation:** The trigonometric system is **complete** in $\mathcal{L}^2(\mathbb{T})$. This is mathematically encapsulated by the **Rieszâ€“Fischer Theorem** (also known as the Plancherel identity on the torus), which guarantees perfect energy conservation [1]:
                            <div class="bg-white p-4 rounded-lg border text-center text-sm md:text-base">
                                $\frac{1}{2\pi} \int |f(x)|^2 dx = \sum_{n \in \mathbb{Z}} |c_n|^2$
                            </div>
                            This demonstrates the **unitary isomorphism** between the continuous function space $\mathcal{L}^2(\mathbb{T})$ and the discrete sequence space $\ell^2(\mathbb{Z})$.
                        </li>
                    </ul>
                    
                </div>
            </section>

            <section id="convergence" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Convergence: Dirichlet Summation vs. CesÃ ro Means</h3>
                 <p class="mb-6 text-gray-700 leading-relaxed">Convergence depends on the summation method. The standard partial sum, $S_N$ (Dirichlet Summation), uses the unstable Dirichlet kernel. The **Dirichletâ€“Jordan Test** proves pointwise convergence for functions of bounded variation (BV).[6]</p>
                 <p class="mb-6 text-gray-700 leading-relaxed">However, $S_N$ fails to converge uniformly for discontinuous functions, leading to the **Gibbs Phenomenon**â€”a persistent overshoot near the jump discontinuity. This overshoot magnitude never decays, remaining approximately $9\%$ of the jump size.[7]</p>
                 <p class="mb-6 text-gray-700 leading-relaxed">The **CesÃ ro mean**, $\sigma_N$ (FejÃ©r Summation), is the arithmetic average of the partial sums. **FejÃ©r's Theorem** states that for any continuous function $f \in C(\mathbb{T})$, the CesÃ ro means $\sigma_N$ converge **uniformly** to $f$.[8] This stability arises because the FejÃ©r kernel is non-negative, satisfying the properties of a "good kernel" and avoiding the oscillations of the Dirichlet kernel.[9, 10]</p>
                <div class="control-panel mb-4">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
                         <div class="flex items-center space-x-4">
                            <span class="font-medium text-lg">Summation Method:</span>
                            <div class="flex space-x-2 p-1 bg-gray-100 rounded-lg">
                                <button id="dirichletBtn" class="px-3 py-1 text-sm rounded-md bg-blue-500 text-white font-medium">Dirichlet ($S_N$)</button>
                                <button id="cesaroBtn" class="px-3 py-1 text-sm rounded-md text-gray-700 font-medium">CesÃ ro ($\sigma_N$)</button>
                            </div>
                        </div>
                        <div class="w-full md:w-auto">
                            <label for="termsSlider" class="block font-medium">Number of Terms (N): <span id="termsValue">5</span></label>
                            <input type="range" id="termsSlider" min="1" max="100" value="5" class="w-full">
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="gibbsChart"></canvas>
                </div>
                <p id="convergenceNote" class="mt-4 text-sm italic text-gray-600 text-center"></p>
            </section>

            <section id="coefficients" class="content-section hidden">
                 <h3 class="text-3xl font-semibold mb-4">Coefficient Properties & Function Smoothness</h3>
                 <p class="mb-6 text-gray-700 leading-relaxed">The rate at which the Fourier coefficients decay to zero is the mathematical fingerprint of the function's smoothness (or regularity class). This relationship is fundamental to defining **Sobolev Spaces** using the frequency domain.[11]</p>
                <ul class="list-disc list-inside mb-6 space-y-2 text-gray-700">
                    <li>**Riemannâ€“Lebesgue Lemma:** The most basic principle states that if $f$ is Lebesgue integrable ($\mathcal{L}^1$), its coefficients must tend to zero as $|n| \to \infty$, i.e., $\lim_{|n| \to \infty} c_n(f) = 0$.[12, 13]</li>
                    <li>**Algebraic Decay:** If $f$ is continuously differentiable $k$ times ($f \in C^k$), its coefficients decay algebraically: $|c_n| = \mathcal{O}(|n|^{-(k+1)})$. Discontinuities lead to the slowest decay ($\mathcal{O}(|n|^{-1})$).</li>
                    <li>**Rapid/Exponential Decay:** Functions that are infinitely differentiable ($C^\infty$) have coefficients that decay faster than any polynomial. Functions that are **analytic** (extendable to the complex plane) exhibit exponential decay.</li>
                </ul>
                <p class="mb-6 text-gray-700 leading-relaxed">Select a function type below to see a visual representation of its form and the corresponding decay rate of its Fourier coefficient magnitudes.</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <button class="coeff-button bg-blue-500 text-white px-4 py-2 rounded-lg" data-func="discontinuous">Discontinuous (Square)</button>
                    <button class="coeff-button bg-gray-300 text-gray-800 px-4 py-2 rounded-lg" data-func="continuous">Continuous (Triangle)</button>
                    <button class="coeff-button bg-gray-300 text-gray-800 px-4 py-2 rounded-lg" data-func="smooth">Smooth (Parabolic)</button>
                </div>
                <div class="grid md:grid-cols-2 gap-8 mt-6">
                    <div class="chart-container h-[35vh] max-h-[350px]">
                        <canvas id="functionShapeChart"></canvas>
                    </div>
                    <div class="chart-container h-[35vh] max-h-[350px]">
                        <canvas id="coefficientDecayChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="complex_coeffs" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Complex Spectral Geometry ($\mathbf{c_n}$)</h3>
                <p class="mb-6 text-gray-700 leading-relaxed">The exponential Fourier Series $f(x) \sim \sum c_n e^{inx}$ provides the most elegant representation. The coefficients $c_n$ are complex numbers that encode both the magnitude and phase of each harmonic.[14]</p>
                <ul class="list-disc list-inside mb-6 space-y-2 text-gray-700">
                     <li>**Conjugate Symmetry:** For a real-valued function $f(x)$, the spectrum must satisfy the rigorous condition that $c_{-n} = \overline{c_n}$ (the coefficient for negative frequency is the complex conjugate of the positive frequency coefficient).[15]</li>
                     <li>**Amplitude-Phase Form:** $c_n$ can be expressed in polar coordinates, where its magnitude $|c_n|$ is related to the energy of the $n$-th harmonic and its argument (angle) is the phase shift $\phi_n$.[14]</li>
                </ul>
                <div class="control-panel mb-4">
                     <label for="coeffCount" class="block mb-2 font-medium">Number of Harmonic Pairs (N): <span id="coeffCountValue">5</span></label>
                    <input type="range" id="coeffCount" min="1" max="15" value="5" class="w-full">
                </div>
                <div class="chart-container">
                    <canvas id="complexCoeffsChart"></canvas>
                </div>
                <p class="mt-4 text-sm italic text-gray-600 text-center">Coefficients $c_n$ and $c_{-n}$ for the Square Wave (an odd function, so all $c_n$ are purely imaginary, lying on the vertical axis).</p>
            </section>
            
             <section id="thd" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Signal Quality Mathematics: Total Harmonic Distortion (THD)</h3>
                <div class="space-y-6 text-gray-700 leading-relaxed">
                    <p>Total Harmonic Distortion (THD) is a mathematical measure of the spectral purity of a periodic function. It rigorously quantifies the power contained in all higher-order harmonics relative to the power of the fundamental frequency.</p>
                    <p>Using the **Parseval identity**, which equates the signal's energy (in the time domain, $\mathcal{L}^2$ norm) to the sum of the energies of its harmonics (in the frequency domain, $\ell^2$ norm), THD is defined as the ratio of the energy of the distortion to the energy of the fundamental component (assuming $n=\pm 1$ is the fundamental, and $c_0$ is removed):</p>
                    <div class="bg-white p-4 rounded-lg border text-center text-sm md:text-base">
                        $$\text{THD} = \sqrt{\frac{\sum_{|n| \ge 2} |c_n|^2}{|c_1|^2}} = \sqrt{\frac{\text{Power}_{\text{Harmonics}}}{\text{Power}_{\text{Fundamental}}}}$$
                    </div>
                    <p>This definition links THD directly to the **Mean Squared Error (MSE)** incurred when approximating the function using only its fundamental frequency component, providing an exact measure of approximation quality in the $\mathcal{L}^2$ sense.</p>
                </div>
            </section>

            <section id="examples" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Classic Waveform Examples</h3>
                <p class="mb-6 text-gray-700 leading-relaxed">Applying Fourier analysis to fundamental periodic functions provides concrete examples of the theory. Each function has a unique series representation determined by its symmetries and shape. Odd functions have only sine terms (all $a_n = 0$), while even functions have only cosine terms (all $b_n = 0$). Explore the series for some classic waveforms below. Adjust the slider to see how the series approximation builds the function.</p>
                <div class="control-panel mb-4 flex flex-col md:flex-row items-center gap-4">
                    <div class="w-full md:w-1/2">
                        <label for="waveformSelect" class="block mb-2 font-medium">Select Waveform:</label>
                        <select id="waveformSelect" class="w-full p-2 border rounded-lg">
                            <option value="square" selected>Square Wave</option>
                            <option value="triangle">Triangle Wave</option>
                            <option value="sawtooth">Sawtooth Wave</option>
                        </select>
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="exampleTermsSlider" class="block mb-2 font-medium">Number of Terms (N): <span id="exampleTermsValue">5</span></label>
                        <input type="range" id="exampleTermsSlider" min="1" max="100" value="5" class="w-full">
                    </div>
                </div>
                 <div class="chart-container">
                    <canvas id="exampleChart"></canvas>
                </div>
                 <div id="seriesFormula" class="mt-6 bg-white p-4 rounded-lg border text-center text-sm md:text-base"></div>
            </section>

            <section id="connections" class="content-section hidden">
                <h3 class="text-3xl font-semibold mb-4">Broader Mathematical Connections</h3>
                 <div class="space-y-6 text-gray-700 leading-relaxed">
                    <ul class="list-disc list-inside space-y-3">
                        <li>**Fourier Transform (FT) & Distribution Theory:** The FT is the mathematical generalization of the Fourier Series achieved by letting the period $L \to \infty$. This limiting process is rigorously defined using the theory of **tempered distributions** ($\mathcal{S}'$), allowing even generalized functions (like the Dirac delta) to have a defined spectrum.[5, 16, 17]</li>
                        <li>**Abstract Harmonic Analysis (AHA):** Classical Fourier Series is the decomposition of the function space on the compact Abelian group $\mathbb{R}/\mathbb{Z}$ (the torus). This is formalized by **Pontryagin Duality**, which relates this group to its dual group, $\mathbb{Z}$ (the discrete frequency indices).[18, 19]</li>
                        <li>**Spectral Theory & PDEs:** The Fourier basis $\{e^{inx}\}$ are the eigenfunctions of the differentiation operator. This means Fourier analysis **diagonalizes** the operator, which is the analytical basis for solving linear Partial Differential Equations (PDEs) like the Heat Equation using the method of **Separation of Variables**.[20, 21]</li>
                        <li>**Multidimensional Fourier Series:** For functions of multiple variables ($f(\mathbf{x})$), the convergence properties become complex. The convergence of the partial sum $S_N$ depends critically on the **method of summation** used (e.g., cubic vs. spherical truncation) [22], a topic of active mathematical research.[23]</li>
                    </ul>
                </div>
            </section>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const navigationLinks = document.querySelectorAll('#navigation a');
    const contentSections = document.querySelectorAll('.content-section');
    let gibbsChart, coeffFuncChart, coeffDecayChart, exampleChart, complexCoeffsChart;
    let currentSummationMethod = 'dirichlet';

    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                type: 'linear',
                position: 'bottom',
                min: -Math.PI,
                max: Math.PI,
                ticks: {
                    callback: function(value) {
                        if (value === -Math.PI) return '-Ï€';
                        if (value === -Math.PI/2) return '-Ï€/2';
                        if (value === 0) return '0';
                        if (value === Math.PI/2) return 'Ï€/2';
                        if (value === Math.PI) return 'Ï€';
                        return null;
                    },
                    maxRotation: 0,
                    autoSkip: false,
                }
            },
            y: {
                min: -1.5,
                max: 1.5
            }
        },
        plugins: {
            legend: {
                display: true
            },
            tooltip: {
                enabled: true
            }
        },
        elements: {
            point: {
                radius: 0
            }
        },
        animation: {
            duration: 0
        }
    };
    
    function generatePoints(func, numPoints = 200) {
        const data = [];
        const step = (2 * Math.PI) / numPoints;
        for (let i = 0; i <= numPoints; i++) {
            const x = -Math.PI + i * step;
            data.push({x: x, y: func(x)});
        }
        return data;
    }

    function squareWave(x) {
        return Math.sign(Math.sin(x));
    }

    function fourierSquare(x, N) {
        let sum = 0;
        for (let n = 1; n <= N; n++) {
            if (n % 2 !== 0) {
                sum += (4 / Math.PI) * (Math.sin(n * x) / n);
            }
        }
        return sum;
    }

    function fourierCesaroSquare(x, N) {
        let sum = 0;
        for (let n = 1; n <= N; n++) {
            if (n % 2 !== 0) {
                sum += (4 / Math.PI) * (Math.sin(n * x) / n) * (1 - n/(N+1));
            }
        }
        return sum;
    }

    function triangleWave(x) {
        return (2/Math.PI) * Math.asin(Math.sin(x));
    }

    function fourierTriangle(x, N) {
        let sum = 0;
        for (let n = 1; n <= N; n++) {
             if (n % 2 !== 0) {
                sum += (8 / (Math.PI**2)) * (((-1)**((n-1)/2)) / (n**2)) * Math.sin(n * x);
            }
        }
        return sum;
    }

    function sawtoothWave(x){
        return (x/Math.PI);
    }

    function fourierSawtooth(x, N){
        let sum = 0;
        for (let n = 1; n <= N; n++) {
            sum += (2/Math.PI) * ((-1)**(n+1)) * (Math.sin(n*x)/n);
        }
        return sum;
    }

    function parabolicWave(x){
        return (x*x) / (Math.PI*Math.PI) * 2 - 1;
    }

    function setupGibbsChart() {
        const ctx = document.getElementById('gibbsChart').getContext('2d');
        const slider = document.getElementById('termsSlider');
        const valueDisplay = document.getElementById('termsValue');
        const dirichletBtn = document.getElementById('dirichletBtn');
        const cesaroBtn = document.getElementById('cesaroBtn');
        const note = document.getElementById('convergenceNote');
        
        const approximationFuncs = {
            'dirichlet': fourierSquare,
            'cesaro': fourierCesaroSquare
        };

        const datasets = [{
            label: 'Original Square Wave',
            data: generatePoints(squareWave),
            borderColor: 'rgba(239, 68, 68, 0.8)',
            borderWidth: 3,
            borderDash: [5, 5]
        }, {
            label: 'Fourier Approximation (N terms)',
            data: generatePoints(x => approximationFuncs[currentSummationMethod](x, parseInt(slider.value))),
            borderColor: 'rgba(59, 130, 246, 0.8)',
            borderWidth: 2,
            fill: false
        }];

        gibbsChart = new Chart(ctx, {
            type: 'line',
            data: { datasets: datasets },
            options: chartOptions
        });

        function updateChart() {
            const N = parseInt(slider.value);
            valueDisplay.textContent = N;
            
            gibbsChart.data.datasets[1].data = generatePoints(x => approximationFuncs[currentSummationMethod](x, N));
            
            if (currentSummationMethod === 'dirichlet') {
                gibbsChart.data.datasets[1].label = 'Dirichlet Summation S\u2092';
                note.textContent = 'Dirichlet summation ($S_N$) exhibits the Gibbs overshoot at discontinuities due to the oscillatory Dirichlet kernel.';
                dirichletBtn.classList.add('bg-blue-500', 'text-white');
                cesaroBtn.classList.remove('bg-blue-500', 'text-white');
            } else {
                gibbsChart.data.datasets[1].label = 'CesÃ ro Mean \u03C3\u2092';
                note.textContent = 'CesÃ ro summation ($\u03C3_N$) (FejÃ©r\'s Theorem) eliminates the Gibbs overshoot but converges more smoothly and slowly, demonstrating the stability of the FejÃ©r kernel.';
                cesaroBtn.classList.add('bg-blue-500', 'text-white');
                dirichletBtn.classList.remove('bg-blue-500', 'text-white');
            }
            gibbsChart.update();
        }

        slider.addEventListener('input', updateChart);
        dirichletBtn.addEventListener('click', () => { currentSummationMethod = 'dirichlet'; updateChart(); });
        cesaroBtn.addEventListener('click', () => { currentSummationMethod = 'cesaro'; updateChart(); });
        
        updateChart(); 
    }

    function setupCoefficientsChart() {
        const funcCtx = document.getElementById('functionShapeChart').getContext('2d');
        const decayCtx = document.getElementById('coefficientDecayChart').getContext('2d');
        const buttons = document.querySelectorAll('.coeff-button');

        let currentFunc = 'discontinuous';
        const numCoeffs = 20;

        const funcs = {
            'discontinuous': { 
                func: squareWave, 
                // |b_n| = 4/(pi*n) for odd n, 0 otherwise (O(1/n) decay)
                coeffs: Array.from({length: numCoeffs}, (_, i) => (i+1)%2 === 0? 0 : Math.abs(4/(Math.PI*(i+1)))) 
            },
            'continuous': { 
                func: triangleWave, 
                // |b_n| = 8/(pi^2 * n^2) for odd n, 0 otherwise (O(1/n^2) decay)
                coeffs: Array.from({length: numCoeffs}, (_, i) => (i+1)%2 === 0? 0 : Math.abs(8/((Math.PI**2)*((i+1)**2))))
            },
            'smooth': { 
                func: parabolicWave, 
                // Parabolic is even, a_n related to 1/n^2. Uses |c_n| ~ |a_n|/2
                coeffs: Array.from({length: numCoeffs}, (_, i) => i === 0? 0 : Math.abs((4*((-1)**(i+1)))/((i+1)**2 * Math.PI**2)))
            }
        };

        coeffFuncChart = new Chart(funcCtx, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Function Shape',
                    data: generatePoints(funcs[currentFunc].func),
                    borderColor: 'rgba(34, 197, 94, 1)',
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        min: -Math.PI,
                        max: Math.PI,
                        ticks: {
                            callback: function(value) {
                                if (Math.abs(value - (-Math.PI)) < 0.1) return '-Ï€';
                                if (Math.abs(value - (-Math.PI/2)) < 0.1) return '-Ï€/2';
                                if (Math.abs(value - 0) < 0.1) return '0';
                                if (Math.abs(value - Math.PI/2) < 0.1) return 'Ï€/2';
                                if (Math.abs(value - Math.PI) < 0.1) return 'Ï€';
                                return null;
                            },
                            maxRotation: 0,
                            autoSkip: false,
                        }
                    },
                    y: {
                        min: -1.2,
                        max: 1.2
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true
                    }
                },
                elements: {
                    point: {
                        radius: 0
                    }
                },
                animation: {
                    duration: 0
                }
            }
        });
        
        coeffDecayChart = new Chart(decayCtx, {
            type: 'bar',
            data: {
                labels: Array.from({length: numCoeffs}, (_, i) => `n=${i+1}`),
                datasets: [{
                    label: 'Coefficient Magnitude |c\u2099|',
                    data: funcs[currentFunc].coeffs,
                    backgroundColor: 'rgba(168, 85, 247, 0.7)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Magnitude' } },
                    x: { title: { display: true, text: 'Harmonic number (n)' } }
                },
                plugins: { legend: { display: false } }
            }
        });

        function updateCoeffCharts(funcType) {
            currentFunc = funcType;
            coeffFuncChart.data.datasets[0].data = generatePoints(funcs[currentFunc].func);
            coeffDecayChart.data.datasets[0].data = funcs[currentFunc].coeffs;
            coeffFuncChart.update();
            coeffDecayChart.update();
            
            buttons.forEach(btn => {
                if (btn.dataset.func === funcType) {
                    btn.classList.remove('bg-gray-300', 'text-gray-800');
                    btn.classList.add('bg-blue-500', 'text-white');
                } else {
                    btn.classList.remove('bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-300', 'text-gray-800');
                }
            });
        }
        
        buttons.forEach(button => {
            button.addEventListener('click', () => updateCoeffCharts(button.dataset.func));
        });
        
        // Initial state is already set during chart creation
    }

    function setupComplexCoefficientsChart() {
        const ctx = document.getElementById('complexCoeffsChart').getContext('2d');
        const slider = document.getElementById('coeffCount');
        const valueDisplay = document.getElementById('coeffCountValue');
        
        const complexChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    title: { display: true, text: 'Real Part' },
                    min: -1,
                    max: 1,
                    grid: { borderColor: '#ccc' }
                },
                y: {
                    type: 'linear',
                    position: 'left',
                    title: { display: true, text: 'Imaginary Part' },
                    min: -1,
                    max: 1,
                    grid: { borderColor: '#ccc' }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const n = context.raw.n;
                            const real = context.raw.x.toFixed(4);
                            const imag = context.raw.y.toFixed(4);
                            return `c${n} = ${real} + ${imag}i`;
                        }
                    }
                }
            },
            elements: {
                point: { radius: 6, hoverRadius: 8, hitRadius: 10 }
            }
        };

        function getComplexCoeffs(N) {
            const points = [];
            // Square Wave coefficients: c_n = 2/(i * pi * n) for odd n. Real part is 0.
            for (let n = 1; n <= N; n++) {
                if (n % 2 !== 0) {
                    // c_n (n > 0): Real=0, Imag = -2/(pi*n)
                    const imag_n = -2 / (Math.PI * n);
                    points.push({ x: 0, y: imag_n, n: n, color: 'rgba(59, 130, 246, 1)' });

                    // c_-n (n < 0): Real=0, Imag = 2/(pi*n). This is the conjugate.
                    const imag_neg_n = 2 / (Math.PI * n);
                    points.push({ x: 0, y: imag_neg_n, n: -n, color: 'rgba(239, 68, 68, 1)' });
                }
            }
            return points;
        }

        const initialN = parseInt(slider.value);
        const datasets = [{
            label: 'Complex Coefficients',
            data: getComplexCoeffs(initialN),
            pointBackgroundColor: (context) => context.raw.color,
            pointBorderColor: (context) => context.raw.color,
        }];

        complexCoeffsChart = new Chart(ctx, {
            type: 'scatter',
            data: { datasets: datasets },
            options: complexChartOptions
        });

        function updateComplexChart() {
            const N = parseInt(slider.value);
            valueDisplay.textContent = N;
            
            complexCoeffsChart.data.datasets[0].data = getComplexCoeffs(N);
            complexCoeffsChart.update();
        }

        slider.addEventListener('input', updateComplexChart);
        updateComplexChart(); 
    }
    
    function setupExampleChart() {
        const ctx = document.getElementById('exampleChart').getContext('2d');
        const slider = document.getElementById('exampleTermsSlider');
        const valueDisplay = document.getElementById('exampleTermsValue');
        const selector = document.getElementById('waveformSelect');
        const formulaDisplay = document.getElementById('seriesFormula');

        const waveforms = {
            'square': {
                original: squareWave,
                fourier: fourierSquare,
                formula: 'f(x) \u2248 (4/\u03C0) \u03A3\u2099\u208D\u2081,\u2083,.. (sin(nx)/n) (Odd/Sine Series)'
            },
            'triangle': {
                original: triangleWave,
                fourier: fourierTriangle,
                formula: 'f(x) \u2248 (8/\u03C0\u00B2) \u03A3\u2099\u208D\u2081,\u2083,.. ((-1)^((n-1)/2) sin(nx)/n\u00B2) (Odd/Sine Series)'
            },
            'sawtooth': {
                original: sawtoothWave,
                fourier: fourierSawtooth,
                formula: 'f(x) \u2248 (2/\u03C0) \u03A3\u2099\u208D\u2081 ((-1)^(n+1) sin(nx)/n) (Odd/Sine Series)'
            }
        };

        const datasets = [{
            label: 'Original Waveform',
            data: generatePoints(waveforms[selector.value].original),
            borderColor: 'rgba(239, 68, 68, 0.8)',
            borderWidth: 3,
            borderDash: [5, 5]
        }, {
            label: 'Fourier Approximation (N terms)',
            data: generatePoints(x => waveforms[selector.value].fourier(x, parseInt(slider.value))),
            borderColor: 'rgba(59, 130, 246, 0.8)',
            borderWidth: 2,
            fill: false
        }];

        exampleChart = new Chart(ctx, {
            type: 'line',
            data: { datasets: datasets },
            options: chartOptions
        });

        function updateExample() {
            const N = parseInt(slider.value);
            const wave = selector.value;
            valueDisplay.textContent = N;
            formulaDisplay.textContent = waveforms[wave].formula;
            
            exampleChart.data.datasets.data = generatePoints(waveforms[wave].original);
            exampleChart.data.datasets.label = `Original ${wave.charAt(0).toUpperCase() + wave.slice(1)} Wave`;
            exampleChart.data.datasets[1].data = generatePoints(x => waveforms[wave].fourier(x, N));
            exampleChart.update();
        }

        slider.addEventListener('input', updateExample);
        selector.addEventListener('change', updateExample);
        
        updateExample();
    }
    
    let activeTab = 'foundations';
    const chartInitializers = {
        'convergence': setupGibbsChart,
        'coefficients': setupCoefficientsChart,
        'complex_coeffs': setupComplexCoefficientsChart,
        'examples': setupExampleChart,
        // No initializers needed for historical, foundations, thd, connections
    };
    const initializedCharts = {};

    navigationLinks.forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            const targetId = link.dataset.target;
            
            if (targetId === activeTab) return;
            activeTab = targetId;
            
            navigationLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            
            contentSections.forEach(section => {
                if (section.id === targetId) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            if (chartInitializers[targetId] &&!initializedCharts[targetId]) {
                chartInitializers[targetId]();
                initializedCharts[targetId] = true;
            }
        });
    });
    
    // Initial setup for the first active tab
    if (chartInitializers) {
        chartInitializers();
        initializedCharts = true;
    }
});
</script>
</body>
</html>
